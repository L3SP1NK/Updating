#!/bin/bash
## Update my git repository.

## TODO:
## - Check if git is installed.
## - Clean this mess.

GREEN="\e[32m"
RED="\e[31m"
RESET_COLOR="\e[0m"

CWD=$(pwd)
USER_HOME="/home/lespink"
REPOS_LOCATION="/opt/My-Repo/"

function UPDATE_GIT()
{
				## Search for GIT repos.
				for GIT_PATH in $(find ${REPOS_LOCATION} -type d -name ".git" 2>/dev/null)
					do
						cd ${GIT_PATH}
						echo -e "\n${BLUE}${BOLD}${GIT_LOCATION}${RESET_COLOR}"
						cd ..
						git config pull.rebase false
						## Pull change
						git pull
						## Add files to the repo
						git add -v .*
						git add -v *
						## Commit change
						git commit -a
						git push -v
						## Pull change
						git pull
						## Add files to the repo
						git add -v .*
						## Commit change
						git commit -a
						git push -v
						cd ${CWD}
						## Make link
						## User dot-files
						ln -svf /opt/My-Repo/Configs/dot-files/.* ${USER_HOME} 2>/dev/null
						## Root dot-files
						ln -svf /opt/My-Repo/Configs/dot-files/.* ${HOME} 2>/dev/null
						## Script link
						ln -svf /opt/My-Repo/Updating/* /bin/
						ln -svf /opt/My-Repo/Utilities/* /bin/
						ln -svf /opt/My-Repo/Wallpapers-Management/* /bin/
						ln -svf /opt/My-Repo/Telebash/* /bin/
				done
}

which git >/dev/null

if [[ ${?} -eq "0" ]]
	then
		if [ "$EUID" -ne 0 ]
			then
				echo -e "${RED}This script must be run as root!\nExiting...${RESET_COLOR}"
				exit 1
			else
				if [[ -f ${USER_HOME}/.git-credentials ]]
					then
						cd ${REPOS_LOCATION}
						UPDATE_GIT
					else
						echo -e "${RED}Git credentials not found!\nExiting...${RESET_COLOR}"
						exit 1
				fi
		fi
	else
		echo -e "${RED}Git isn't installed on this system!\nExiting...${RESET_COLOR}"
		exit 1
fi
